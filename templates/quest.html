<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Quest Game</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #111; color: #eee; }
    #game-box { max-width: 700px; margin: 50px auto; background: #222; padding: 20px; border-radius: 12px; }
    textarea { height: 400px; }
  </style>
</head>
<body>
  <div id="game-box">
    <h2 class="text-center">⚔️ Quest Challenge ⚔️</h2>
    <textarea id="output" class="form-control mb-3" readonly></textarea>

    <!-- Wrap input + button in a form so Enter triggers submit -->
    <form id="answerForm" class="d-flex gap-2">
      <input id="userInput" type="text" class="form-control" placeholder="Enter your answer..." autocomplete="off" autofocus>
      <button id="submitBtn" class="btn btn-primary">Submit</button>
    </form>
  </div>

  <script>
    const output = document.getElementById("output");
    const input = document.getElementById("userInput");
    const form = document.getElementById("answerForm");
    const btn = document.getElementById("submitBtn");

    function append(text) {
      if (!text) return;
      output.value += text + "\n";
      output.scrollTop = output.scrollHeight;
    }

    async function startGame() {
      try {
        const res = await fetch("/play", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ action: "start" })
        });
        const data = await res.json();
        append(data.output);
      } catch (e) {
        append("Error starting game: " + e);
      }
      input.focus();
    }

    async function sendAnswer(answer) {
      if (!answer) return;
      btn.disabled = true;

      append("> " + answer);

      try {
        const res = await fetch("/play", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ action: "answer", answer })
        });
        const data = await res.json();
        append(data.output);
        if (data.finished) append("--- Game finished ---");
      } catch (e) {
        append("Network error: " + e);
      } finally {
        btn.disabled = false;
        input.focus();
      }
    }

    // Handle form submit (Enter key or button press)
    form.addEventListener("submit", (ev) => {
      ev.preventDefault();
      const val = input.value.trim();
      if (!val) return;
      sendAnswer(val);
      input.value = "";
    });

    // keep button click handler for older browsers (optional)
    btn.addEventListener("click", (ev) => {
      ev.preventDefault(); // prevent any default form action (safety)
      const val = input.value.trim();
      if (!val) return;
      sendAnswer(val);
      input.value = "";
    });

    // Start the game on load
    startGame();
  </script>
</body>
</html>
